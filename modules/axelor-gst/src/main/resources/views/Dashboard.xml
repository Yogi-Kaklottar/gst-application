<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.2.xsd">
 <dashboard name="gst-dashboard" title="Unpaid Invoice">
   <dashlet action="gst.dashboard.invoice.unpaid.chart"/>
   <dashlet action="gst.dashboard.invoice.paid.product"/>
   <dashlet action="gst.dashboard.invoice.state.customer"/>
   <dashlet action="gst.dashboard.invoice.status.type"/>
   <dashlet action="gst.dashboard.invoice.status.type.amount" colSpan="6"/>
   <dashlet action="gst.dashboard.invoice.unpaid.month.before" colSpan="6"/>
 </dashboard>
 <action-view name="gst.dashboard.invoice.unpaid.chart" title="unPaid Invoice Cutomer CHART">
       <view type="chart" name="dashboard-gst-unpaid-chart"/>
 </action-view>
  <action-view name="gst.dashboard.invoice.paid.product" title="Paid invoices per category per product">
       <view type="chart" name="dashboard-gst-paid-chart"/>
 </action-view>
  <action-view name="gst.dashboard.invoice.state.customer" title="state wise customer">
       <view type="chart" name="dashboard-gst-state-chart"/>
 </action-view>
 <action-view name="gst.dashboard.invoice.status.type" title="status wise Invoice">
       <view type="chart" name="dashboard-gst-invoice-status-chart"/>
 </action-view>
 <action-view name="gst.dashboard.invoice.status.type.amount" title="status wise Amount Invoice">
       <view type="chart" name="dashboard-gst-invoice-status-amount-chart"/>
 </action-view>
 <action-view name="gst.dashboard.invoice.unpaid.month.before" title="Unpaid One Month Before Invoice " model="com.axelor.gst.db.Invoice">
       <view type="grid" name="gst-invoice-grid"/>
      <domain>self.status = 'Validated' and self.status != 'Paid' and self.curruntDate &lt; :oneMonthday</domain>
      <context name="oneMonthday" expr="eval:LocalDate.now().withDayOfMonth(1)"/>
 </action-view>


<!--  Unpaid invoices per customer : Bar chart -->

<chart name="dashboard-gst-unpaid-chart" title="Total Unpaid Customer" onInit="action-gst-chart-unpaid-customer-defaultdate">
    <search-fields>
      <field name="toDateT" type="datetime" title="To Date"  x-required="true" />
      <field name="fromDateT" type="datetime" title="From Date"   x-required="true" />
    </search-fields>
    <dataset type="jpql">
     <![CDATA[
      select product.name as _productName,COUNT(invoice.id) as _number
      From Invoice invoice
      LEFT JOIN
          invoice.party as product
      where
        (invoice.status='Draft' OR invoice.status='Validated')
        and
        invoice.curruntDate >=:toDateT
        AND
         invoice.curruntDate <= :fromDateT
       group by
          product.name


      ]]>
    </dataset>
    <category key="_productName" type="text" />
    <series key="_number" type="bar" />
  </chart>


<!--   Paid invoices per category per product: Bar chart -->


  <chart name="dashboard-gst-paid-chart" title="Total paid Product" onInit="action-gst-chart-unpaid-customer-defaultdate">
    <search-fields>
       <field name="toDateT" type="datetime" title="From Date"   x-required="true" />
      <field name="fromDateT" type="datetime" title="To Date"  x-required="true" />
    </search-fields>
    <dataset type="jpql">
     <![CDATA[
      select _product.name,_category.name as _categoryName,COUNT(invoiceLine.invoice) as _number
           from InvoiceLine invoiceLine
           LEFT JOIN
               invoiceLine.invoice  as _invoice
           LEFT JOIN
               invoiceLine.product as _product
           LEFT JOIN
               _product.category as _category
            where
               _invoice.status='Paid'
               and
              _invoice.curruntDate >= :toDateT
              AND
             _invoice.curruntDate <= :fromDateT
      GROUP BY
                _product.name,
              _category.name
      ]]>
    </dataset>
    <category key="_categoryName" type="text" />
    <series key="_number" type="bar" />
  </chart>

  <!--   Customer per state: Pie chart -->

  <chart name="dashboard-gst-state-chart" title="Total State Wise Customer">

    <dataset type="jpql">
     <![CDATA[
       SELECT
    state.name as _stateName,
    COUNT(address.party.name) as _partyCount
    FROM
    Address address
    LEFT JOIN
    address.state as state
    GROUP BY
    state


      ]]>
    </dataset>
    <category key="_stateName" type="text" />
    <series key="_partyCount" type="pie" />
  </chart>


<!--   Invoice per status: amount bar chart, number of invoices line chart -->


   <chart name="dashboard-gst-invoice-status-chart" title="Total Status Vice Invoice">

    <dataset type="jpql">
     <![CDATA[
       SELECT
    invoice.status as _stausType,Count(invoice.id) as _number
    from Invoice invoice
    Group By
      invoice.status

      ]]>
    </dataset>
    <category key="_stausType" type="text" />
    <series key="_number" type="bar" />
  </chart>
  <chart name="dashboard-gst-invoice-status-amount-chart" title="Total Status Vice Amount Invoice">

    <dataset type="jpql">
     <![CDATA[
       SELECT
    invoice.status as _stausType,sum(invoice.grossAmount) as _number
    from Invoice invoice
    Group By
      invoice.status

      ]]>
    </dataset>
    <category key="_stausType" type="text" />
    <series key="_number" type="bar" />
  </chart>




  <action-record name="action-gst-chart-unpaid-customer-defaultdate" model="com.axelor.gst.db.Invoice">
    <field name="toDateT" expr="eval:LocalDate.now().withDayOfMonth(1)" />
    <field name="fromDateT" expr="eval:__datetime__" />
  </action-record>

</object-views>
